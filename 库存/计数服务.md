# 计数服务

## 模型抽象

> 尽可能列举会使用到计数服务的场景，从中熟悉业务场景，理解业务需求、可能的难点。同时调研业内使用的模型，进而抽象出适合自己业务的模型

### 电商场景

#### 用户主页

- 收藏夹---商品数，支持按时间查看、店铺查看
- 关注店铺数
- 最近足迹数

#### 商品

- 库存
- 销量
- 评价

### 视频网站场景

#### 用户主页

- 动态
  - 个人动态
  - 关注人的动态总数
- 关注
- 粉丝
- 虚拟币

#### 视频

- 播放量
- 点赞数
- 踩
- 评论
- 收藏
- 转发
- 投币数

### 短视频场景

####  用户主页

- 总获赞数
- 关注
- 粉丝
- 作品数
  - 公开数
  - 私密数
- 喜欢的作品数
- 收藏的作品数

#### 视频

- 播放量
- 点赞
- 评论
- 收藏
- 转发

### 微博场景

> 贴吧、脉脉、论坛、微博

#### 用户主页

- 关注
- 粉丝数
- 个人帖子总数

#### 帖子

- 点赞
- 评论
- 转发
- 分享

### 社交软件场景

> QQ、微信、飞书的未读消息、

- 未读消息总数
- 各个群、聊天框未读消息总数

### 小结

- 有些计数只是个数字，如库存、销量、视频/帖子等维度短视频点赞数、转发数
- 有些数字点击数字之后，需要能链接到具体的信息，如个人主页的关注、点赞、收藏等。这个信息肯定不是计数服务出，但是不是会需要计数服务提供一些关键 id 呢？--- 应该不需要，直接点击用户服务->获取相关列表信息即可，无需经过计数服务。计数服务只是提供了一个数字的展示

从以上场景来看，计数服务本质上就是解决：【某个实体有多少个数 】的问题

1. 不同的实体类型的计数会有差异吗？

   这里的计数肯定不是指单纯的加1减1，是指不同类型的实体其实可能会有不同的计数规则。计数规则是不是应该放到业务层，不应该耦合到计数服务中？

2. 目前来看，似乎计数服务只需要提供好加减技术接口和读接口就好，其实很像库存系统的计数，但是比库存系统的计数更简单（不需要有预扣、实际扣减等考虑）。所以是不是一个 key-value 就够了呢？

3. 如果只做一个 key-value 的话，计数服务能为业务提供的能力实际上是很有限的。为了给业务提供更好用的服务，实际是需要对业务场景做抽象的：

   1. 按发生时间段计数，比如过去一天、一周某个实体的点赞数、评论数
   2. 视频类型，各个时间段的播放量。比如前10分钟播放量是多少，后10分钟播放量是多少，能看到最后的播放量（完播量）